$(document).ready((function(){var e=$("#non_campaign_table").DataTable({columnDefs:[{orderable:!1,targets:"no-sort"}],order:[[2,"desc"]],dom:"<'row'<'col-sm-6'l><'col-sm-6'f>><'row'<'col-sm-12'<'clear-reports-button'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-5'i><'col-sm-7'p>>",initComplete:function(){$(".clear-reports-button").html('<button id="clear_reports_btn" class="btn btn-danger pull-right" style="margin-bottom: 10px;"><i class="fa fa-trash"></i> Clear Reports</button>'),$("#clear_reports_btn").on("click",r)}});function t(){$("#loading").show(),$("#stats_div").hide(),$("#non_campaign_table_div").hide(),$("#no_reports_message").hide(),query("/imap/non_campaign_reports","GET",{},!0).success((function(t){if($("#loading").hide(),$("#filter_div").show(),t.stats&&t.stats.report_count>0){$("#report_count").text(t.stats.report_count);var r="Never";t.stats.last_reported_at&&"0001-01-01T00:00:00Z"!==t.stats.last_reported_at&&(r=moment(t.stats.last_reported_at).format("MMMM Do YYYY, h:mm:ss a")),$("#last_reported").text(r),$("#stats_div").show()}e.clear(),t.reports&&t.reports.length>0?($.each(t.reports,(function(t,r){var n=moment(r.reported_at).format("MMMM Do YYYY, h:mm:ss a");e.row.add([o(r.reporter_email),o(r.subject),n])})),e.draw(),$("#non_campaign_table_div").show()):$("#no_reports_message").show()})).error((function(e,t,r){$("#loading").hide(),console.error("Error loading non-campaign reports:",r),errorFlash("Failed to load non-campaign reports")}))}function r(){Swal.fire({title:"Are you sure?",text:"This will permanently delete all displayed non-campaign phishing reports. This action cannot be undone.",type:"warning",showCancelButton:!0,confirmButtonColor:"#d9534f",confirmButtonText:"Yes, delete them!",closeOnConfirm:!1,showLoaderOnConfirm:!0}).then((function(r){r.value&&query("/imap/non_campaign_reports","DELETE",{},!0).success((function(r){Swal.fire({title:"Deleted!",text:"The reports have been deleted.",type:"success"}).then((function(){$("#stats_div").hide(),$("#non_campaign_table_div").hide(),e.clear().draw(),$("#no_reports_message").hide(),t()}))})).error((function(e,t,r){console.error("API error:",r,e.responseText),Swal.fire({title:"Error!",text:"An error occurred while deleting the reports. Please try again.",type:"error"})}))}))}function o(e){return $("<div>").text(e).html()}$("#filter_div").hide(),t(),api.campaigns.get().success((function(e){var t=e.filter((function(e){return"In progress"===e.status}));if(t.length>0){var r=$("<div class='alert alert-info'><strong>Active Campaign RIDs:</strong> ");t.forEach((function(e,o){r.append("<span class='label label-primary'>"+e.name+" (RID: "+e.id+")</span>"),o<t.length-1&&r.append(" ")})),r.append("</div>"),$("#stats_div").after(r)}})).error((function(e,t,r){console.error("Error loading active campaigns:",r)}))}));