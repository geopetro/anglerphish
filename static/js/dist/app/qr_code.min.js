function formatDate(e){const o=new Date(e);return o.toLocaleDateString()+" "+o.toLocaleTimeString()}function createDownloadButton(e){return $("<button>").addClass("btn btn-sm btn-primary").html('<i class="fa fa-download"></i>').attr("data-toggle","tooltip").attr("title","Download").click((function(){downloadQRCode(e.id)}))}function createDeleteButton(e,o){return $("<button>").addClass("btn btn-sm btn-danger").html('<i class="fa fa-trash"></i>').attr("data-toggle","tooltip").attr("title","Delete").click((function(){confirm("Are you sure you want to delete this QR code?")&&deleteQRCode(e.id,o)}))}function downloadQRCode(e){api.qrCodeId.get(e).success((function(e){if(e.success){for(var o=atob(e.qr_code_base64),t=new Array(o.length),n=0;n<o.length;n++)t[n]=o.charCodeAt(n);var r=new Uint8Array(t),a=new Blob([r],{type:"image/png"}),d=document.createElement("a");d.href=window.URL.createObjectURL(a),d.download=e.filename,document.body.appendChild(d),d.click(),document.body.removeChild(d),setTimeout((function(){window.URL.revokeObjectURL(d.href)}),100),successFlash("QR code downloaded successfully!")}else errorFlash(e.message||"Error downloading QR code")})).error((function(e){errorFlash(e.responseJSON.message||"Error downloading QR code")}))}function deleteQRCode(e,o){api.qr_code.delete(e).success((function(e){e.success?(successFlash("QR code deleted successfully!"),o&&o()):errorFlash(e.message||"Error deleting QR code")})).error((function(e){errorFlash(e.responseJSON.message||"Error deleting QR code")}))}function loadQRCodes(){$("#loading_qr_codes").show(),$("#no_qr_codes").hide(),$("#qrCodeTable tbody").empty(),api.qr_code.get().success((function(e){$("#loading_qr_codes").hide(),e.qr_codes&&e.qr_codes.length>0?($.each(e.qr_codes,(function(e,o){var t=$("<tr>");t.append($("<td>").text(o.url)),t.append($("<td>").text(o.size)),t.append($("<td>").text(formatDate(o.created_at)));var n=$("<td>").addClass("text-center");n.append(createDownloadButton(o)),n.append(" "),n.append(createDeleteButton(o,loadQRCodes)),t.append(n),$("#qrCodeTable tbody").append(t)})),$('[data-toggle="tooltip"]').tooltip()):$("#no_qr_codes").show()})).error((function(e){$("#loading_qr_codes").hide(),errorFlash(e.responseJSON.message||"Error loading QR codes")}))}function generate_code(){var e={};e.url=$("#url").val(),e.size=$("#size").val()||"256";var o=$("#storeInDb").is(":checked");e.url?api.qr_code.post({url:e.url,size:e.size,storeInDb:o}).success((function(e){if(e.success){for(var t=atob(e.qr_code_base64),n=new Array(t.length),r=0;r<t.length;r++)n[r]=t.charCodeAt(r);var a=new Uint8Array(n),d=new Blob([a],{type:"image/png"}),s=document.createElement("a");s.href=window.URL.createObjectURL(d),s.download=e.filename,document.body.appendChild(s),s.click(),document.body.removeChild(s),setTimeout((function(){window.URL.revokeObjectURL(s.href)}),100),successFlash("QR code downloaded successfully!"),$("#url").val(""),$("#size").val(""),$("#url").focus(),o&&loadQRCodes()}else errorFlash(e.message||"Error generating QR code")})).error((function(e){errorFlash(e.responseJSON.message||"Error generating QR code")})):errorFlash("Please enter a URL")}$(document).ready((function(){$('[data-toggle="tooltip"]').tooltip(),$("#url").focus(),$("#url, #size").keypress((function(e){if(13==e.which)return generate_code(),!1})),loadQRCodes(),CKEDITOR.on("dialogDefinition",(function(e){var o=e.data.name,t=e.data.definition;"link"==o&&(t.minWidth=500,t.minHeight=100,t.getContents("info").get("linkType").hidden=!0)}))}));